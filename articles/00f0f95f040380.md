---
title: "æ—¢å­˜ã®Amazon ECSã‚¯ãƒ©ã‚¹ã‚¿ã§Container Insightsã‚’æœ‰åŠ¹ã«ã™ã‚‹"
emoji: "ğŸ˜¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['aws']
published: true
---
# ã¯ã˜ã‚ã«

ã“ã®è¨­å®šã‚’ã—ã‚ˆã†ã¨ã™ã‚‹ã¨æ¯å›èª¿ã¹ã‚‹ã“ã¨ã«ãªã‚‹ã®ã§ã€ã„ã¤ã‚‚ã®æ‰‹é †ã‚’ãƒ¡ãƒ¢ã€‚

# ç’°å¢ƒ

* aws-cli 2.7.2

# Container Insightsã‚’æœ‰åŠ¹ã«ã™ã‚‹

* ç¾åœ¨ã®è¨­å®šã‚’ç¢ºèªã™ã‚‹

```sh
$ aws ecs describe-clusters \
  --cluster {clusterName} \
  --include SETTINGS

{
    "clusters": [
        {
            "clusterArn": "arn:aws:ecs:***",
            "clusterName": "{clusterName}",
            "status": "ACTIVE",
            "registeredContainerInstancesCount": 0,
            "runningTasksCount": 1,
            "pendingTasksCount": 0,
            "activeServicesCount": 1,
            "statistics": [],
            "tags": [],
            "settings": [
                {
                    "name": "containerInsights",
                    "value": "disabled"
                }
            ],
            "capacityProviders": [
                "FARGATE",
                "FARGATE_SPOT"
            ],
            "defaultCapacityProviderStrategy": []
        }
    ],
    "failures": []
}
```

* Container Insightsã‚’æœ‰åŠ¹ã«ã™ã‚‹

```sh
$ aws ecs update-cluster-settings \
  --cluster {clusterName} \
  --settings name=containerInsights,value=enabled

{
    "cluster": {
        "clusterArn": "arn:aws:ecs:***",
        "clusterName": "{clusterName}",
        "status": "ACTIVE",
        "registeredContainerInstancesCount": 0,
        "runningTasksCount": 0,
        "pendingTasksCount": 0,
        "activeServicesCount": 0,
        "statistics": [],
        "tags": [],
        "settings": [
            {
                "name": "containerInsights",
                "value": "enabled"
            }
        ],
        "capacityProviders": [
            "FARGATE",
            "FARGATE_SPOT"
        ],
        "defaultCapacityProviderStrategy": [],
        "attachments": [],
        "attachmentsStatus": "UPDATE_COMPLETE"
    }
}
```

* è¨­å®šãŒæœ‰åŠ¹ã«ãªã£ãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹

```sh
$ aws ecs describe-clusters \
  --cluster {clusterName} \
  --include SETTINGS

{
    "clusters": [
        {
            "clusterArn": "arn:aws:ecs:***",
            "clusterName": "{clusterName}",
            "status": "ACTIVE",
            "registeredContainerInstancesCount": 0,
            "runningTasksCount": 1,
            "pendingTasksCount": 0,
            "activeServicesCount": 1,
            "statistics": [],
            "tags": [],
            "settings": [
                {
                    "name": "containerInsights",
                    "value": "enabled"
                }
            ],
            "capacityProviders": [
                "FARGATE",
                "FARGATE_SPOT"
            ],
            "defaultCapacityProviderStrategy": []
        }
    ],
    "failures": []
}
```

# ã¾ã¨ã‚

æ—¢å­˜ã®Amazon ECSã‚¯ãƒ©ã‚¹ã‚¿ã§Container Insightsã‚’æœ‰åŠ¹ã«ã™ã‚‹å ´åˆã®ã€AWS CLIã§ã®è¨­å®šæ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚

# å‚è€ƒ

* [ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŠã‚ˆã³ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ãƒ™ãƒ«ã® Amazon ECS ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã® Container Insights ã®è¨­å®š](https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/deploy-container-insights-ECS-cluster.html)
* [update-cluster-settings](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ecs/update-cluster-settings.html)
* [describe-clusters](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ecs/describe-clusters.html)
